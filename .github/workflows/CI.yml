name: CI
on:
  merge_group:
  pull_request:
  push:
    branches:
      - master
    tags: "*"
  schedule:
    - cron: "0 2 * * *"  # Daily at 2 a.m. UTC
jobs:
    # If this is not a `pull_request` run: Yes, run the `test-*` jobs.
    # If this is a `pull_request` run, and it is NOT from a fork: Yes, run the `test-*` jobs.
    # If this a `pull_request` run, and it IS from a fork: No, do not run the `test-*` jobs.
    #
    # We avoid running on fork PRs because OIDC will fail on those PRs.
  test-julia-min:
    if: ${{ github.event_name != 'pull_request' || github.repository == github.event.pull_request.head.repo.full_name }}
    uses: ./.github/workflows/test_reusable_workflow.yml
    with:
      julia-version: 'min' # Oldest supported version
  test-julia-lts:
    if: ${{ github.event_name != 'pull_request' || github.repository == github.event.pull_request.head.repo.full_name }}
    uses: ./.github/workflows/test_reusable_workflow.yml
    with:
      julia-version: 'lts' # Long Term Stable
  test-julia-v1:
    if: ${{ github.event_name != 'pull_request' || github.repository == github.event.pull_request.head.repo.full_name }}
    uses: ./.github/workflows/test_reusable_workflow.yml
    with:
      julia-version: '1' # Latest Release
  docs:
    name: Documentation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: julia-actions/setup-julia@v2
        with:
          version: "1"
      - uses: julia-actions/cache@v2
      - uses: julia-actions/julia-buildpkg@v1
      - uses: julia-actions/julia-docdeploy@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          DOCUMENTER_KEY: ${{ secrets.DOCUMENTER_KEY }}
